{% extends "!layout.html" %}
{#
    NOTE: This file completely overrides the Alabaster layout to implement a custom
    Flexbox structure (main-layout-wrapper -> top-content-row + sidebar)
    while ensuring the sidebar is only rendered if defined to avoid UndefinedError.
#}

{# Blocks that are suppressed to manage the structure completely here #}
{% block relbar1 %}{% endblock %}
{% block relbar2 %}{% endblock %}
{% block sidebars %}{% endblock %}

{% block content %}
    {#
        Top-level wrapper for background image and overall Flex/Block control
        (Targeted by #main-layout-wrapper in custom.css)
    #}
    <div id="main-layout-wrapper">

        {# Wrapper to group Content and Controls for side-by-side display on tablet/desktop #}
        <div id="top-content-row">

            {# 1. Controls Column - Must be outside the content block for independent positioning #}
            <div id="custom-fixed-controls">
                <div id="image-links-container">
                    {# Custom content generated by custom.js will be inserted here #}
                </div>
            </div>

            {# 2. Main Content Area (Targeted by #main-content-column in custom.css) #}
            <div id="main-content-column">
                <div class="documentwrapper">
                    <div class="bodywrapper">
                        <div class="body" role="main">
                            {# Standard Sphinx Content Block #}
                            {% block body %}{% endblock %}
                        </div>
                    </div>
                </div>
                {# Placeholder for custom footer content or the standard Alabaster footer/relbar #}
                {{ custom_footer_content }}
                {# FIX: Use the standard Alabaster block to render the footer content #}
                {% block footer %}
                    {# The Alabaster template defines the "powered by" and copyright here #}
                {% endblock %}
            </div>

        </div>
        {# END #top-content-row #}

        {# 3. Sidebar (Must be a sibling of #top-content-row to allow Flex ordering) #}

        {# CRITICAL FIX: Only render the sidebar block if 'sidebar' is defined to avoid UndefinedError #}
        {% if sidebar %}
            <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
                <div class="sphinxsidebarwrapper">
                    {% block sidebar_wrapper %}
                        {# The actual function call that renders the sidebar components (toc.html, searchbox.html, etc.) #}
                        {% block sidebar1 %}
                            {{ sidebar() }}
                        {% endblock %}
                        {% block sidebar2 %}{% endblock %}
                    {% endblock %}
                </div>
            </div>
        {% endif %}

    </div>
{% endblock %}